{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\user\\\\Desktop\\\\finalproject\\\\finalproject_refactoring\\\\front\\\\src\\\\my\\\\MyPay.jsx\",\n  _s = $RefreshSig$();\nimport axios from 'axios';\nimport React, { useEffect } from 'react';\nimport { useState } from 'react';\nimport { useContext } from 'react';\nimport { Button } from 'react-bootstrap';\nimport { UserContext } from '../context/UserContext';\nimport Swal from 'sweetalert2';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { swalErrorPayment, swalErrorVerification, swalQueryReviewWrite } from '../util/swal/swal.my.util';\nimport { swalError } from '../util/swal/swal.basic.util';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst MyPay = () => {\n  _s();\n  const {\n    loginUser\n  } = useContext(UserContext);\n  const {\n    pcode\n  } = useParams();\n  const navigate = useNavigate();\n  const [productInfo, SetProductInfo] = useState({\n    pwriter: '',\n    pprice: '',\n    pname: ''\n  });\n  const extractReadData = async () => {\n    const result = await axios.get(`/api/pboard/data/${pcode}`);\n    SetProductInfo(result.data);\n  };\n  const {\n    pwriter,\n    pprice,\n    pname\n  } = productInfo;\n  const onClickPayment = () => {\n    const {\n      IMP\n    } = window;\n    IMP.init('imp37385705'); // 결제 데이터 정의\n    const data = {\n      pg: 'html5_inicis',\n      // PG사 (필수항목)\n      pay_method: 'card',\n      // 결제수단 (필수항목)\n      merchant_uid: `pay_${new Date().getTime()}`,\n      // 주문번호 (필수항목)\n      name: pname,\n      // 주문명 (필수항목)\n      amount: pprice,\n      // 금액이고 반드시 숫자로 써야함. (필수항목)\n      custom_data: {\n        name: '부가정보',\n        desc: '세부 부가정보'\n      },\n      buyer_name: loginUser.uname,\n      // 구매자 이름\n      buyer_tel: loginUser.utel,\n      // 구매자 전화번호 (필수항목)\n      buyer_email: loginUser.uemail,\n      // 구매자 이메일\n      buyer_addr: loginUser.uaddress\n    };\n    IMP.request_pay(data, paymentCallback);\n  };\n  const paymentCallback = async response => {\n    const {\n      success,\n      error_msg,\n      imp_uid,\n      merchant_uid,\n      buyer_email,\n      pay_method,\n      paid_amount\n    } = response;\n    try {\n      const result = await axios.post(`/payment/${imp_uid}`);\n\n      //verify forgery\n      if (result.data.response.amount === paid_amount) {\n        console.log('검증 완료');\n      } else {\n        swalErrorVerification();\n      }\n    } catch (e) {\n      swalError();\n    }\n\n    //pay done\n    if (success) {\n      const formData = new FormData();\n      formData.append(\"payprice\", paid_amount);\n      formData.append(\"seller\", pwriter);\n      formData.append(\"buyer\", loginUser.unickname);\n      formData.append(\"paytype\", pay_method);\n      formData.append(\"payemail\", buyer_email);\n      formData.append(\"paycode\", merchant_uid);\n      formData.append(\"pcode\", pcode);\n\n      //pay + review insert\n\n      await axios.post('/payment', formData).then(() => {\n        swalQueryReviewWrite().then(async result => {\n          if (result.isConfirmed) navigate(`/my/review/insert/${merchant_uid}?seller=${pwriter}&buyer=${loginUser.unickname}&pcode=${pcode}`);else if (result.isDismissed) navigate('/my/menu');\n        });\n      }).catch(() => {\n        swalError();\n      });\n    } else {\n      swalErrorPayment(error_msg);\n    }\n  };\n  useEffect(() => {\n    const jquery = document.createElement(\"script\");\n    jquery.src = \"https://code.jquery.com/jquery-1.12.4.min.js\";\n    const iamport = document.createElement(\"script\");\n    iamport.src = \"https://cdn.iamport.kr/js/iamport.payment-1.1.7.js\";\n    document.head.appendChild(jquery);\n    document.head.appendChild(iamport);\n    extractReadData();\n    return () => {\n      document.head.removeChild(jquery);\n      document.head.removeChild(iamport);\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"pay\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"img23\",\n      children: /*#__PURE__*/_jsxDEV(\"img\", {\n        size: \"10px\",\n        className: \"d-block w-100\",\n        src: \"/image/image23.jpg\",\n        alt: \"\\uBE48 \\uC774\\uBBF8\\uC9C0\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"img21\",\n      children: /*#__PURE__*/_jsxDEV(\"img\", {\n        size: \"10px\",\n        className: \"d-block w-100\",\n        src: \"/image/img21.jpg\",\n        alt: \"\\uBE48 \\uC774\\uBBF8\\uC9C0\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Button, {\n      variant: \"warning\",\n      style: {\n        width: '200px',\n        height: '100px'\n      },\n      className: \"pay\",\n      onClick: onClickPayment,\n      children: \"\\uACB0\\uC81C\\uD558\\uAE30\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"animate__animated animate__fadeInUp\",\n      children: /*#__PURE__*/_jsxDEV(\"img\", {\n        size: \"10px\",\n        className: \"d-block w-100\",\n        src: \"/image/image24.jpg\",\n        alt: \"\\uBE48 \\uC774\\uBBF8\\uC9C0\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 106,\n    columnNumber: 5\n  }, this);\n};\n_s(MyPay, \"3gE8YjMcUl9tTtyahnomhB6FShA=\", false, function () {\n  return [useParams, useNavigate];\n});\n_c = MyPay;\nexport default MyPay;\nvar _c;\n$RefreshReg$(_c, \"MyPay\");","map":{"version":3,"names":["axios","React","useEffect","useState","useContext","Button","UserContext","Swal","useNavigate","useParams","swalErrorPayment","swalErrorVerification","swalQueryReviewWrite","swalError","MyPay","loginUser","pcode","navigate","productInfo","SetProductInfo","pwriter","pprice","pname","extractReadData","result","get","data","onClickPayment","IMP","window","init","pg","pay_method","merchant_uid","Date","getTime","name","amount","custom_data","desc","buyer_name","uname","buyer_tel","utel","buyer_email","uemail","buyer_addr","uaddress","request_pay","paymentCallback","response","success","error_msg","imp_uid","paid_amount","post","console","log","e","formData","FormData","append","unickname","then","isConfirmed","isDismissed","catch","jquery","document","createElement","src","iamport","head","appendChild","removeChild","width","height"],"sources":["C:/Users/user/Desktop/finalproject/finalproject_refactoring/front/src/my/MyPay.jsx"],"sourcesContent":["import axios from 'axios';\r\nimport React, { useEffect } from 'react';\r\nimport { useState } from 'react';\r\nimport { useContext } from 'react';\r\nimport { Button } from 'react-bootstrap';\r\nimport { UserContext } from '../context/UserContext';\r\nimport Swal from 'sweetalert2'\r\nimport { useNavigate, useParams } from 'react-router-dom';\r\nimport { swalErrorPayment, swalErrorVerification, swalQueryReviewWrite } from '../util/swal/swal.my.util';\r\nimport { swalError } from '../util/swal/swal.basic.util';\r\n\r\nconst MyPay = () => {\r\n  const { loginUser } = useContext(UserContext);\r\n  const { pcode } = useParams();\r\n  const navigate = useNavigate();\r\n  const [productInfo, SetProductInfo] = useState({\r\n    pwriter: '',\r\n    pprice: '',\r\n    pname: ''\r\n  });\r\n\r\n  const extractReadData = async () => {\r\n    const result = await axios.get(`/api/pboard/data/${pcode}`)\r\n    SetProductInfo(result.data);\r\n  }\r\n\r\n  const { pwriter, pprice, pname } = productInfo;\r\n\r\n  const onClickPayment = () => {\r\n    const { IMP } = window;\r\n    IMP.init('imp37385705'); // 결제 데이터 정의\r\n    const data = {\r\n      pg: 'html5_inicis', // PG사 (필수항목)\r\n      pay_method: 'card', // 결제수단 (필수항목)\r\n      merchant_uid: `pay_${new Date().getTime()}`, // 주문번호 (필수항목)\r\n      name: pname, // 주문명 (필수항목)\r\n      amount: pprice, // 금액이고 반드시 숫자로 써야함. (필수항목)\r\n      custom_data: { name: '부가정보', desc: '세부 부가정보' },\r\n      buyer_name: loginUser.uname, // 구매자 이름\r\n      buyer_tel: loginUser.utel, // 구매자 전화번호 (필수항목)\r\n      buyer_email: loginUser.uemail, // 구매자 이메일\r\n      buyer_addr: loginUser.uaddress,\r\n    };\r\n    IMP.request_pay(data, paymentCallback);\r\n  }\r\n\r\n  const paymentCallback = async (response) => {\r\n    const { success, error_msg, imp_uid, merchant_uid, buyer_email, pay_method, paid_amount } = response;\r\n    try {\r\n      const result = await axios.post(`/payment/${imp_uid}`);\r\n\r\n      //verify forgery\r\n      if (result.data.response.amount === paid_amount) {\r\n        console.log('검증 완료')\r\n      } else {\r\n        swalErrorVerification();\r\n      }\r\n\r\n    } catch (e) {\r\n      swalError();\r\n    }\r\n\r\n    //pay done\r\n    if (success) {\r\n      const formData = new FormData();\r\n      formData.append(\"payprice\", paid_amount);\r\n      formData.append(\"seller\", pwriter);\r\n      formData.append(\"buyer\", loginUser.unickname);\r\n      formData.append(\"paytype\", pay_method);\r\n      formData.append(\"payemail\", buyer_email);\r\n      formData.append(\"paycode\", merchant_uid);\r\n      formData.append(\"pcode\", pcode);\r\n\r\n      //pay + review insert\r\n\r\n      await axios.post('/payment', formData).then(() => {\r\n        swalQueryReviewWrite().then(async (result) => {\r\n          if (result.isConfirmed)\r\n            navigate(`/my/review/insert/${merchant_uid}?seller=${pwriter}&buyer=${loginUser.unickname}&pcode=${pcode}`)\r\n          else if (result.isDismissed)\r\n            navigate('/my/menu')\r\n        })\r\n      }).catch(() => {\r\n        swalError();\r\n      })\r\n    } else {\r\n      swalErrorPayment(error_msg);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    const jquery = document.createElement(\"script\");\r\n    jquery.src = \"https://code.jquery.com/jquery-1.12.4.min.js\";\r\n    const iamport = document.createElement(\"script\");\r\n    iamport.src = \"https://cdn.iamport.kr/js/iamport.payment-1.1.7.js\";\r\n    document.head.appendChild(jquery);\r\n    document.head.appendChild(iamport);\r\n    extractReadData();\r\n    return () => {\r\n      document.head.removeChild(jquery); document.head.removeChild(iamport);\r\n    }\r\n\r\n  }, []);\r\n\r\n  return (\r\n    <div className='pay'>\r\n      <div className='img23'>\r\n        <img\r\n          size='10px'\r\n          className=\"d-block w-100\"\r\n          src=\"/image/image23.jpg\"\r\n          alt=\"빈 이미지\"\r\n        />\r\n      </div>\r\n      <div className='img21'>\r\n        <img\r\n          size='10px'\r\n          className=\"d-block w-100\"\r\n          src=\"/image/img21.jpg\"\r\n          alt=\"빈 이미지\"\r\n        />\r\n      </div>\r\n\r\n      <Button variant=\"warning\" style={{ width: '200px', height: '100px' }}\r\n        className='pay' onClick={onClickPayment}>결제하기</Button>\r\n      <div className='animate__animated animate__fadeInUp'>\r\n        <img\r\n          size='10px'\r\n          className=\"d-block w-100\"\r\n          src=\"/image/image24.jpg\"\r\n          alt=\"빈 이미지\"\r\n        />\r\n      </div>\r\n\r\n\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default MyPay;"],"mappings":"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"},"metadata":{},"sourceType":"module"}